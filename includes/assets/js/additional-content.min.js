/*
 * additional-content
 * v1.2.0
 * 2015-12-02
 **/
!function(a){function b(){var b,e=d.children("div");e.each(function(c){a(this).find("input, textarea, label").each(function(){a(this).attr("id")&&(b=a(this).attr("id").split("-"),a(this).attr("id",b[0]+"-"+c)),a(this).attr("for")&&(b=a(this).attr("for").split("-"),a(this).attr("for",b[0]+"-"+c)),a(this).attr("name")&&(b=a(this).attr("name").split("["),a(this).attr("name",b[0]+"["+c+"]["+b[2]))})}),a("#ac-add-row").val(c(e))}function c(b){var c=e.add_more_row;return 0===a(b).length&&(c=e.add_row),c}var d,e;a(document).ready(function(){if("undefined"!=typeof ac_additional_content&&a(ac_additional_content).length&&(e=ac_additional_content,d=a("#additional-content-container"),d.length)){d.sortable({axis:"y",cursor:"move",containment:"parent",items:"> div",placeholder:"sortable-placeholder",forcePlaceholderSize:!0,helper:"clone",distance:2,tolerance:"pointer",opacity:.65,stop:function(a,c){b()}});var c=(d.children("div"),a("#ac_additional_content_template").html()),f=a('<div><a class="ac-toggle_options" aria-expanded="false" href="#">'+e.show_options+"</a></div>");a(".ac-options").each(function(b){if(a(".ac-option",this).length){if(!a(this).hasClass("js-no-toggle")){var c=a(this).attr("id").split("-"),d="ac-options-"+c[2]+" ac-actions-"+c[2];a("a",f).attr("aria-controls",d),a(this).before(f.clone())}}else{var e=a(this).closest(".ac-repeat-container").find(".ac-actions");e.length&&(e.find("input[type=submit]").addClass("button-small"),e.removeClass("js-visually-hidden"))}}),b(),a("#ac-add-row").on("click",function(e){e.preventDefault(),d.append(c);var f=d.children("div").last();f.find(".ac-options, .ac-actions").removeAttr("id"),a(".ac-option",f).length||f.find("input[type=submit]").addClass("button-small");var g=f.css("backgroundColor");f.css("backgroundColor","#FFFF33").animate({backgroundColor:g},{complete:function(){a(this).css("backgroundColor","")}}),b()}),d.on("click",".ac-remove",function(c){c.preventDefault();var d=a(this).closest(".ac-repeat-container");d.css("backgroundColor","#faa").fadeOut(350,function(){d.remove(),b()})}),d.on("click",".ac-toggle_options",function(b){b.preventDefault();var c=a(this).closest(".ac-repeat-container").find(".ac-options");if(c.length){c.toggleClass("js-visually-hidden");var d=c.hasClass("js-visually-hidden");a(this).text(d?e.show_options:e.hide_options),a(this).closest(".ac-repeat-container").find(".ac-actions").toggleClass("js-visually-hidden"),a(this).attr("aria-expanded",d?"false":"true")}}),d.on("change",'[type="checkbox"]',function(b){var c=e.content,d=a(this).closest("div").find('input[type="checkbox"]:checked');d.length&&(2===d.length?c=e.append_prepend:d.attr("data-ac-type")&&(c=e[d.data("ac-type")]));var f=a(this).closest(".ac-repeat-container").find(".ac-content");f.text(c+":")})}})}(jQuery);